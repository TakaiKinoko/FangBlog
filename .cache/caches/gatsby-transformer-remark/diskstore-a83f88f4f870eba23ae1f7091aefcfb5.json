{"expireTime":9007200830667704000,"key":"transformer-remark-markdown-html-8bd3c89d41ecb638bd2c9529199250d5-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-reading-time-","val":"<p>Motivated by a CUDA puzzle I tried to solve today, I’d like to talk more about resource assignment. </p>\n<h2>A Puzzle</h2>\n<h3>problem</h3>\n<p>Adding two big arrays element-wise.</p>\n<h3>settings</h3>\n<ul>\n<li>Suppose a GPU has 8 SMs</li>\n<li>Each SM has 32 SPs</li>\n<li>Warp size is 16, instead of 32</li>\n<li>kernel adds one element from each array together</li>\n</ul>\n<h3>questions</h3>\n<p>Say if we were to compute everything sequentially, it takes time <code class=\"language-text\">t</code> to finish.</p>\n<h4>scenario 1</h4>\n<p>Assume that 256 threads are enough to keep all SPs in the SM busy all the time. What is the amount of time it’d take to perform the computation for <strong>one block of 1024</strong> threads? </p>\n<h4>scenario 2</h4>\n<p>What if we use <strong>two blocks</strong> of <strong>512 threads</strong> each?</p>\n<h2>CUDA Resource Assignment</h2>\n<p>In order to see how the two scenarios differ, I thougth it was necessary to take another look at how resources are assigned to blocks and warps.</p>\n<h3>sequence of events</h3>\n<ol>\n<li>kernel launch</li>\n<li>CUDA runtime generates the corresponding grid of threads.</li>\n<li>threads are assigned to execution resources on a block-to-block basis.</li>\n</ol>\n<h3>blocks and SMs</h3>\n<p>Multiple blocks can be assigned to each SM. But each device sets a limit on the number of blocks that can be assigned to each SM.</p>\n<p>Say that a device allows 8 blocks to be assigned to each SM. In situations where there’s a <strong>shortage of one or more types of resources</strong> needed for the simultaneous execution of 8 blocks, the CUDA runtime automatically reduces the number of blocks assigned to each SM until their combined resource usage falls below the limit.</p>\n<p>The runtime system:</p>\n<ul>\n<li>maintains a list of blocks that need to execute</li>\n<li>assigns new block to SMs as previously assigned blocks complete execution.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 542px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/50d63938ab66988aafbd2dafbf4bfd02/36b00/blocks.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.992619926199254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAeslc+ZzYX//xAAaEAEBAAIDAAAAAAAAAAAAAAABAgADESEi/9oACAEBAAEFAvQzbWSPD2RrJrP/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFX/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BiP/EABsQAAIBBQAAAAAAAAAAAAAAAAABERAhMVFh/9oACAEBAAY/AnojhcZMvFP/xAAcEAADAAEFAAAAAAAAAAAAAAAAAREhEDFBUYH/2gAIAQEAAT8hd17FgdepH5ixdoUkZIzp/9oADAMBAAIAAwAAABDYz//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxBVdtX/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/ELxkH//EABsQAQACAwEBAAAAAAAAAAAAAAEAMREhURBB/9oACAEBAAE/EAlXMOxUNLg23mVZ38hqqCGS44H0WJd1fn//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"blocks to SM\"\n        title=\"blocks to SM\"\n        src=\"/static/50d63938ab66988aafbd2dafbf4bfd02/36b00/blocks.jpg\"\n        srcset=\"/static/50d63938ab66988aafbd2dafbf4bfd02/7237a/blocks.jpg 148w,\n/static/50d63938ab66988aafbd2dafbf4bfd02/0cfdf/blocks.jpg 295w,\n/static/50d63938ab66988aafbd2dafbf4bfd02/36b00/blocks.jpg 542w\"\n        sizes=\"(max-width: 542px) 100vw, 542px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">blocks to SM</figcaption>\n  </figure></p>\n<h2>Puzzle Solution</h2>\n<h3>scenario 1</h3>\n<p>First, a block\nEven though there are 1024 threads in the block, the number of </p>"}